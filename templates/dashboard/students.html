{% extends 'dashboard/base.html' %}
{% load static %}
{% block title %}Students{% endblock %}
{% block content %}
<div class="app-wrapper">

	<div class="app-content pt-3 p-md-3 p-lg-4">
		<div class="container-xl">

			<div class="d-flex justify-content-between align-items-center mb-4">
				<h1 class="app-page-title mb-0">Students</h1>
				<div class="d-flex align-items-center gap-3">
					<form class="table-search-form row gx-2 align-items-center" method="get" action="">
						<div class="col-auto">
							<div class="input-group align-items-center">
								<span class="input-group-text border-0 bg-transparent"><i class="fas fa-search text-muted"></i></span>
								<input type="text" id="students-search" name="q" class="form-control border-0 shadow-none" placeholder="Search studentsâ€¦" aria-label="Search students" value="{{ request.GET.q }}" autocomplete="off" spellcheck="false" />
								<button type="button" class="btn btn-link px-2 clear-students-search" title="Clear" aria-label="Clear" hidden><i class="fas fa-times-circle text-muted"></i></button>
							</div>
						</div>
						<div class="col-auto">
							<button type="submit" class="btn app-btn-secondary">Search</button>
						</div>
					</form>
					<a class="btn app-btn-primary text-nowrap" href="{% url 'add_user' %}">Create New Student</a>
				</div>
			</div>

			<div class="tab-content" id="orders-table-tab-content">
				<div class="tab-pane fade show active" id="orders-all" role="tabpanel" aria-labelledby="orders-all-tab">
					<div class="app-card app-card-orders-table shadow-sm mb-5">
						<div class="app-card-body">
							<div class="table-responsive">
								<table id="students-table" class="table app-table-hover mb-0 text-left">
									<thead>
										<tr>
											<th class="cell">S.N</th>
											<th class="cell">Name</th>
											<th class="cell">Username</th>
											<th class="cell">Phone</th>
											<th class="cell">Level</th>
											<th class="cell">Actions</th>
										</tr>
									</thead>
									<tbody>
										{% for student in students %}
										<tr>
											<td class="cell">{{ forloop.counter }}</td>
											<td class="cell"><span class="truncate">{{student.first_name}} {{student.last_name}}</span></td>
											<td class="cell">{{student.username}}</td>
											<td class="cell">{{student.phone}}</td>
											<td class="cell">{{student.academic_level}}</td>
<td class="cell"><a class="btn btn-outline-secondary" href="{% url 'dashboard:user_detail' student.id %}">View</a></td>
										</tr>
										{%endfor%}

										<tr class="no-results d-none">
											<td colspan="6" class="text-center text-muted">No matching students</td>
										</tr>


									</tbody>
								</table>
							</div><!--//table-responsive-->

						</div><!--//app-card-body-->
					</div><!--//app-card-->

				</div><!--//tab-pane-->




			</div><!--//tab-content-->


		</div><!--//container-fluid-->
	</div><!--//app-content-->



</div><!--//app-wrapper-->


{% endblock %}
{% block extra_scripts %}
<script src="{% static 'dashboard/assets/plugins/popper.min.js' %}"></script>
<script src="{% static 'dashboard/assets/plugins/bootstrap/js/bootstrap.min.js' %}"></script>

<!-- Page Specific JS -->
<script src="{% static 'dashboard/assets/js/app.js' %}"></script>
<script>
	// Client-side filter to improve UX; server can still handle GET q later
	(function(){
		const input = document.getElementById('students-search');
		const clearBtn = document.querySelector('.clear-students-search');
		const table = document.getElementById('students-table');
		if (!input || !table) return;

		const tbody = table.querySelector('tbody');
		const noResultsRow = tbody.querySelector('.no-results');

		const filter = () => {
			const q = (input.value || '').toLowerCase().trim();
			let visible = 0;
			tbody.querySelectorAll('tr').forEach(tr => {
				if (tr.classList.contains('no-results')) return; // skip helper row
				const text = tr.innerText.toLowerCase();
				const match = !q || text.indexOf(q) !== -1;
				tr.style.display = match ? '' : 'none';
				if (match) visible++;
			});
			if (noResultsRow) noResultsRow.classList.toggle('d-none', visible !== 0);
			if (clearBtn) clearBtn.hidden = q.length === 0;
		};

		input.addEventListener('input', filter);
		if (clearBtn) clearBtn.addEventListener('click', () => { input.value=''; input.focus(); filter(); });
		filter();
	})();
</script>
{% endblock %}