{% extends 'dashboard/base.html' %}
{% load static %}
{% block title %}Course Management{% endblock %}
{% block content %}
<div class="app-wrapper">

	<div class="app-content pt-3 p-md-3 p-lg-4">
		<div class="container-xl">
			{% for message in messages %}
			<div class="alert alert-modern alert-dismissible fade show" role="alert">
				<div class="d-flex align-items-center">
					<i class="fas fa-info-circle me-3 fs-5"></i>
					<div class="flex-grow-1">{{ message }}</div>
				</div>
				<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
			</div>
			{% endfor %}

			<div class="d-flex justify-content-between align-items-center mb-4">
				<h1 class="app-page-title mb-0"><i class="fas fa-book me-2"></i>Subjects</h1>
				<div class="d-flex align-items-center gap-3">
					<div class="input-group" style="max-width: 300px;">
						<span class="input-group-text border-0 bg-transparent"><i class="fas fa-search text-muted"></i></span>
						<input type="text" id="subjects-search" class="form-control border-0 shadow-none" placeholder="Search subjectsâ€¦" autocomplete="off" />
						<button type="button" class="btn btn-link px-2 clear-search" hidden><i class="fas fa-times-circle text-muted"></i></button>
					</div>
					<a class="btn app-btn-primary text-nowrap" href="{% url 'dashboard:add_subject' %}"><i class="fas fa-plus me-2"></i>Create New Subject</a>
				</div>
			</div>

			<div class="tab-content" id="orders-table-tab-content">
				<div class="tab-pane fade show active" id="orders-all" role="tabpanel" aria-labelledby="orders-all-tab">
					<div class="app-card app-card-orders-table shadow-sm mb-5">
						<div class="app-card-body">
							<div class="table-responsive">
								<table id="subjects-table" class="table app-table-hover mb-0 text-left">
									<thead>
										<tr>
											<th class="cell" style="width: 5%;">ID</th>
											<th class="cell" style="width: 20%;">Subject Name</th>
											<th class="cell" style="width: 30%;">Description</th>
											<th class="cell" style="width: 12%;">Academic Level</th>
											<th class="cell" style="width: 18%;">Streams</th>
											<th class="cell" style="width: 15%;">Actions</th>
										</tr>
									</thead>
									<tbody>
										{% for subject in subjects %}
										<tr>
											<td class="cell">
												<span class="badge bg-secondary">#{{subject.id}}</span>
											</td>
											<td class="cell">
												<div class="d-flex align-items-center">
													<i class="fas fa-book text-primary me-2"></i>
													<strong>{{subject.name}}</strong>
												</div>
											</td>
											<td class="cell">
												<small class="text-muted">
													{% if subject.description %}
														{{ subject.description|truncatewords:15 }}
													{% else %}
														<em>No description available</em>
													{% endif %}
												</small>
											</td>
											<td class="cell">
												{% if subject.levels %}
													<span class="badge bg-info">
														<i class="fas fa-graduation-cap me-1"></i>
														{{subject.levels.name}}
													</span>
												{% else %}
													<span class="badge bg-secondary">Not assigned</span>
												{% endif %}
											</td>
											<td class="cell">
												{% with subject.streams.all as s_list %}
													{% if s_list %}
														<div class="d-flex flex-wrap gap-1">
															{% for stream in s_list %}
																<span class="badge bg-success">{{ stream.name }}</span>
															{% endfor %}
														</div>
													{% else %}
														<span class="badge bg-secondary">No streams</span>
													{% endif %}
												{% endwith %}
											</td>
											<td class="cell">
												<a class="btn btn-sm btn-outline-primary" href="{% url 'dashboard:subject_detail' subject.id %}">
													<i class="fas fa-eye me-1"></i>View Details
												</a>
											</td>
										</tr>
										{%endfor%}
									</tbody>
								</table>
							</div><!--//table-responsive-->

						</div><!--//app-card-body-->
					</div><!--//app-card-->

				</div><!--//tab-pane-->




			</div><!--//tab-content-->


		</div><!--//container-fluid-->
	</div><!--//app-content-->



</div><!--//app-wrapper-->


{% endblock %}
{% block extra_scripts %}
<script src="{% static 'dashboard/assets/plugins/popper.min.js' %}"></script>
<script src="{% static 'dashboard/assets/plugins/bootstrap/js/bootstrap.min.js' %}"></script>

<!-- Page Specific JS -->
<script src="{% static 'dashboard/assets/js/app.js' %}"></script>

<script>
	// Lightweight client-side search
	document.addEventListener('DOMContentLoaded', function() {
		const searchInput = document.getElementById('subjects-search');
		const clearBtn = document.querySelector('.clear-search');
		const table = document.getElementById('subjects-table');

		if (searchInput && table) {
			searchInput.addEventListener('input', function() {
				const query = this.value.toLowerCase().trim();
				if (clearBtn) clearBtn.hidden = !query;

				const rows = table.querySelectorAll('tbody tr');
				rows.forEach(row => {
					const text = row.textContent.toLowerCase();
					row.style.display = text.includes(query) ? '' : 'none';
				});
			});

			if (clearBtn) {
				clearBtn.addEventListener('click', function() {
					searchInput.value = '';
					searchInput.dispatchEvent(new Event('input'));
					searchInput.focus();
				});
			}
		}
	});
</script>
{% endblock %}