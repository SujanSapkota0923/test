<!DOCTYPE html>
<html lang="en">
{% load static %}

<head>
  <title>Dashboard |{% block title %} {% endblock %}</title>

  <!-- Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <meta name="description" content="Portal - Bootstrap 5 Admin Dashboard Template For Developers" />
  <meta name="author" content="Xiaoying Riley at 3rd Wave Media" />
  <link rel="shortcut icon" href="{% static 'dashboard/assets/images/favicon.ico' %}" />

  <!-- FontAwesome JS-->
  <script defer src="{% static 'dashboard/assets/plugins/fontawesome/js/all.min.js' %}"></script>

  <!-- App CSS -->
  <link id="theme-style" rel="stylesheet" href="{% static 'dashboard/assets/css/portal.css' %}" />
  
  <!-- Custom Design Enhancements -->
  <link rel="stylesheet" href="{% static 'dashboard/assets/css/custom-enhancements.css' %}" />
  
  <!-- Modern Redesign CSS -->
  <link rel="stylesheet" href="{% static 'dashboard/assets/css/modern-redesign.css' %}" />
  
  <style>
    /* Modern Search Bar Styles */
    .app-search-box-modern {
      width: 100%;
      max-width: 450px;
    }
    
    .search-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      background: #f8f9fa;
      border: 2px solid transparent;
      border-radius: 24px;
      padding: 8px 16px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }
    
    .search-wrapper:hover {
      background: #fff;
      border-color: rgba(21, 163, 98, 0.2);
      box-shadow: 0 4px 12px rgba(21, 163, 98, 0.08);
    }
    
    .search-wrapper:focus-within {
      background: #fff;
      border-color: #15a362;
      box-shadow: 0 4px 20px rgba(21, 163, 98, 0.15);
      transform: translateY(-1px);
    }
    
    .search-icon {
      color: #9ca3af;
      font-size: 16px;
      margin-right: 12px;
      transition: color 0.3s ease;
    }
    
    .search-wrapper:focus-within .search-icon {
      color: #15a362;
    }
    
    .search-input {
      flex: 1;
      border: none;
      background: transparent;
      outline: none;
      font-size: 15px;
      color: #1f2937;
      padding: 4px 0;
      font-weight: 400;
    }
    
    .search-input::placeholder {
      color: #9ca3af;
      font-weight: 400;
    }
    
    .btn-clear-search {
      background: none;
      border: none;
      color: #9ca3af;
      padding: 4px 8px;
      cursor: pointer;
      border-radius: 50%;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 4px;
    }
    
    .btn-clear-search:hover {
      background: rgba(21, 163, 98, 0.1);
      color: #15a362;
    }
    
    .btn-clear-search i {
      font-size: 14px;
    }
    
    .search-shortcut {
      background: #e5e7eb;
      color: #6b7280;
      padding: 3px 8px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      margin-left: 8px;
      font-family: monospace;
      border: 1px solid #d1d5db;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      transition: all 0.2s ease;
    }
    
    .search-wrapper:focus-within .search-shortcut {
      opacity: 0;
      transform: scale(0.9);
    }
    
    /* Responsive adjustments */
    @media (max-width: 991px) {
      .app-search-box-modern {
        max-width: 100%;
      }
    }
    
    @media (max-width: 576px) {
      .search-wrapper {
        padding: 6px 12px;
      }
      
      .search-input {
        font-size: 14px;
      }
      
      .search-shortcut {
        display: none;
      }
    }
    
    /* Enhanced Active State Highlighting for Sidebar */
    .app-nav-modern .nav-link.active {
      background: linear-gradient(135deg, #15a362 0%, #0f7c4a 100%) !important;
      color: white !important;
      box-shadow: 0 4px 12px rgba(21, 163, 98, 0.3), 0 2px 4px rgba(0, 0, 0, 0.1) !important;
      transform: translateX(4px);
      position: relative;
    }
    
    .app-nav-modern .nav-link.active::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 4px;
      height: 60%;
      background: white;
      border-radius: 0 4px 4px 0;
      box-shadow: 0 2px 8px rgba(255, 255, 255, 0.4);
    }
    
    .app-nav-modern .nav-link.active .nav-icon {
      color: white !important;
      animation: iconPulse 2s ease-in-out infinite;
    }
    
    .app-nav-modern .nav-link.active .nav-link-text {
      color: white !important;
      font-weight: 600 !important;
    }
    
    @keyframes iconPulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.1);
      }
    }
    
    /* Enhanced Active State for Submenu Items */
    .submenu-modern .submenu-link.active {
      background: rgba(21, 163, 98, 0.1) !important;
      color: #15a362 !important;
      font-weight: 600 !important;
      border-left: 3px solid #15a362 !important;
      padding-left: 1.75rem !important;
    }
    
    .submenu-modern .submenu-link.active::before {
      background: #15a362 !important;
      width: 8px !important;
      height: 8px !important;
      box-shadow: 0 0 8px rgba(21, 163, 98, 0.5) !important;
    }
    
    .submenu-modern .submenu-link.active i {
      color: #15a362 !important;
    }
    
    /* Hover states shouldn't override active */
    .app-nav-modern .nav-link.active:hover {
      background: linear-gradient(135deg, #15a362 0%, #0f7c4a 100%) !important;
      transform: translateX(4px);
    }
  </style>
</head>

<body class="app">
  <header class="app-header fixed-top">
    <div class="app-header-inner">
      <div class="container-fluid">
        <div class="app-header-content">
          <div class="row align-items-center">
            <!-- Mobile Menu Toggle -->
            <div class="col-auto">
              <a id="sidepanel-toggler" class="sidepanel-toggler d-inline-block d-xl-none" href="#">
                <i class="fas fa-bars fa-lg"></i>
              </a>
            </div>
            
            <!-- Search Box -->
            <div class="col d-flex justify-content-center justify-content-lg-end pe-lg-4">
              <div class="app-search-box-modern">
                <form class="app-search-form" action="{% url 'dashboard:global_search' %}" method="GET" role="search">
                  <div class="search-wrapper">
                    <i class="fas fa-search search-icon"></i>
                    <input id="global-search" type="text" placeholder="Search anything... (try: user:john)" name="q" aria-label="Search"
                           class="search-input" autocomplete="off" autocapitalize="off" spellcheck="false" />
                    <button type="button" class="btn-clear-search" title="Clear" aria-label="Clear search" hidden>
                      <i class="fas fa-times"></i>
                    </button>
                    <kbd class="search-shortcut">/</kbd>
                  </div>
                </form>
              </div>
            </div>

            <!-- Right Side Utilities (Only Profile) -->
            <div class="app-utilities col-auto">
              <div class="app-utility-item app-user-dropdown dropdown">
                <a class="dropdown-toggle d-flex align-items-center gap-2" id="user-dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button"
                  aria-expanded="false">
                  {% if user.profile_picture %}
                  <img class="user-avatar" src="{{ user.profile_picture.url }}" alt="{{ user.username }}" />
                  {% else %}
                  <img class="user-avatar" src="{% static 'dashboard/assets/images/default-profile.png' %}" alt="{{user.username}}" />
                  {% endif %}
                  <span class="user-name d-none d-lg-inline">{{user.username | title}}</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end shadow-lg" aria-labelledby="user-dropdown-toggle">
                  <li class="dropdown-header">
                    <div class="user-info">
                      <strong>{{user.username | title}}</strong>
                      <small class="text-muted d-block">Signed in</small>
                    </div>
                  </li>
                  <li><hr class="dropdown-divider" /></li>
                  <li>
                    <a class="dropdown-item text-danger" href="{% url 'dashboard:logout' %}"><i class="fas fa-sign-out-alt me-2"></i>Log Out</a>
                  </li>
                </ul>
              </div>
              <!--//app-user-dropdown-->
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="app-sidepanel" class="app-sidepanel">
      <div id="sidepanel-drop" class="sidepanel-drop"></div>
      <div class="sidepanel-inner d-flex flex-column">
        <a href="#" id="sidepanel-close" class="sidepanel-close d-xl-none">&times;</a>
        
        <!-- Modern Branding -->
        <div class="app-branding-modern">
          <a class="app-logo-modern" href="{% url 'dashboard:index' %}">
            <div class="logo-icon-modern">
              <i class="fas fa-atom"></i>
            </div>
            <div class="logo-text-container">
              <div class="logo-text-modern">Durbar Physics</div>
              <div class="logo-tagline">Learning Portal</div>
            </div>
          </a>
        </div>

        <!-- Navigation -->
        <nav id="app-nav-main" class="app-nav-modern flex-grow-1">
          <div class="nav-section">
            <div class="nav-section-title">Main Menu</div>
            
            <ul class="app-menu list-unstyled">
              <li class="nav-item">
                <a class="nav-link {% if request.path == '/' %}active{% endif %}" href="{% url 'dashboard:index' %}">
                  <span class="nav-icon">
                    <i class="fas fa-home"></i>
                  </span>
                  <span class="nav-link-text">Dashboard</span>
                </a>
              </li>
              
              <li class="nav-item">
                <a class="nav-link {% if '/subjects/' in request.path %}active{% endif %}"
                  href="{% url 'dashboard:subject_home' %}">
                  <span class="nav-icon">
                    <i class="fas fa-book"></i>
                  </span>
                  <span class="nav-link-text">Subjects</span>
                  <!-- <span class="nav-badge">{{ subjects_count|default:"0" }}</span> -->
                </a>
              </li>
              
              <li class="nav-item">
                <a class="nav-link {% if '/course/' in request.path %}active{% endif %}"
                  href="{% url 'dashboard:course_home' %}">
                  <span class="nav-icon">
                    <i class="fas fa-graduation-cap"></i>
                  </span>
                  <span class="nav-link-text">Courses</span>
                  <!-- <span class="nav-badge">{{ courses_count|default:"0" }}</span> -->
                </a>
              </li>
              
              <li class="nav-item has-submenu">
                <a class="nav-link submenu-toggle {% if '/class' in request.path %}active{% endif %}"
                  href="#" data-bs-toggle="collapse" data-bs-target="#submenu-1"
                  aria-expanded="false" aria-controls="submenu-1">
                  <span class="nav-icon">
                    <i class="fas fa-chalkboard-teacher"></i>
                  </span>
                  <span class="nav-link-text">Classes</span>
                  <span class="submenu-arrow">
                    <i class="fas fa-chevron-down"></i>
                  </span>
                </a>

                <div id="submenu-1" class="collapse submenu-modern" data-bs-parent="#menu-accordion">
                  <ul class="submenu-list list-unstyled">
                    {% for level in levels %}
                    <li class="submenu-item">
                      <a class="submenu-link {% if level.slug in request.path %}active{% endif %}" 
                         href="{% url 'dashboard:class_level' level.slug %}">
                        {{ level.name }}
                      </a>
                      <a href="{% url 'dashboard:level_detail' level.pk %}" 
                         class="submenu-action" 
                         title="Edit {{ level.name }}">
                        <i class="fas fa-edit"></i>
                      </a>
                    </li>
                    {% endfor %}
                  </ul>
                </div>
              </li>
              <li class="nav-item">
                <a class="nav-link {% if '/enrollment' in request.path %}active{% endif %}" 
                   href="{% url 'dashboard:enrollment_home' %}">
                  <span class="nav-icon">
                    <i class="fas fa-user-check"></i>
                  </span>
                  <span class="nav-link-text">Enrollments</span>
                </a>
              </li>
            </ul>
          </div>

          <div class="nav-section">
            <div class="nav-section-title">People</div>
            
            <ul class="app-menu list-unstyled">
              <li class="nav-item has-submenu">
                <a class="nav-link submenu-toggle {% if '/teacher' in request.path or '/student' in request.path %}active{% endif %}" 
                   href="#" data-bs-toggle="collapse" data-bs-target="#submenu-2"
                   aria-expanded="false" aria-controls="submenu-2">
                  <span class="nav-icon">
                    <i class="fas fa-users"></i>
                  </span>
                  <span class="nav-link-text">Users</span>
                  <span class="submenu-arrow">
                    <i class="fas fa-chevron-down"></i>
                  </span>
                </a>
                <div id="submenu-2" class="collapse submenu-modern" data-bs-parent="#menu-accordion">
                  <ul class="submenu-list list-unstyled">
                    <li class="submenu-item">
                      <a class="submenu-link {% if '/teacher' in request.path %}active{% endif %}" 
                         href="{% url 'dashboard:teacher_home' %}">
                        <i class="fas fa-chalkboard-teacher me-2"></i> Teachers
                      </a>
                    </li>
                    <li class="submenu-item">
                      <a class="submenu-link {% if '/student' in request.path %}active{% endif %}" 
                         href="{% url 'dashboard:student_home' %}">
                        <i class="fas fa-user-graduate me-2"></i> Students
                      </a>
                    </li>
                  </ul>
                </div>
              </li>

              <li class="nav-item">
                <a class="nav-link {% if '/stream' in request.path %}active{% endif %}" 
                   href="{% url 'dashboard:stream_home' %}">
                  <span class="nav-icon">
                    <i class="fas fa-layer-group"></i>
                  </span>
                  <span class="nav-link-text">Streams</span>
                </a>
              </li>
              
              
            </ul>
          </div>

          <div class="nav-section">
            <div class="nav-section-title">Content</div>
            
            <ul class="app-menu list-unstyled">
              <li class="nav-item">
                <a class="nav-link {% if '/live' in request.path %}active{% endif %}" 
                   href="{% url 'dashboard:live_classes' %}">
                  <span class="nav-icon">
                    <i class="fas fa-video"></i>
                  </span>
                  <span class="nav-link-text">Live Classes</span>
                  <span class="live-indicator"></span>
                </a>
              </li>
              
              <li class="nav-item">
                <a class="nav-link {% if '/video' in request.path %}active{% endif %}" 
                   href="{% url 'dashboard:video_home' %}">
                  <span class="nav-icon">
                    <i class="fas fa-play-circle"></i>
                  </span>
                  <span class="nav-link-text">Videos</span>
                </a>
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </div>
  </header>
  <!--//app-header-->

  {% block content %} {% endblock %}

  <footer class="app-footer">
    <div class="container py-3 d-flex justify-content-center align-items-center" style="min-height:60px;">
      <small class="copyright m-0">Designed by Kitwosd</small>
    </div>
  </footer>
  <!--//app-footer-->
  <!-- Theme toggle script: toggles `dark-mode` class on <body> and persists choice -->
  <script src="{% static 'dashboard/assets/plugins/popper.min.js' %}"></script>
  <script src="{% static 'dashboard/assets/plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'dashboard/assets/js/app.js' %}"></script>
  <script>
    // Modern search bar enhancements
    document.addEventListener('DOMContentLoaded', function () {
      const input = document.getElementById('global-search');
      const clearBtn = document.querySelector('.btn-clear-search');
      const searchWrapper = document.querySelector('.search-wrapper');

      if (!input || !clearBtn) return;

      const updateState = () => {
        const hasValue = input.value && input.value.trim().length > 0;
        clearBtn.hidden = !hasValue;
      };

      input.addEventListener('input', updateState);
      
      clearBtn.addEventListener('click', () => {
        input.value = '';
        input.focus();
        updateState();
      });

      // Quick focus shortcut: press '/' to focus search
      window.addEventListener('keydown', (e) => {
        if (e.key === '/' && !e.ctrlKey && !e.metaKey && !e.altKey) {
          const tag = (document.activeElement && document.activeElement.tagName) || '';
          if (!['INPUT', 'TEXTAREA', 'SELECT'].includes(tag)) {
            e.preventDefault();
            input.focus();
          }
        }
        
        // ESC to clear and blur
        if (e.key === 'Escape' && document.activeElement === input) {
          input.value = '';
          input.blur();
          updateState();
        }
      });

      updateState();
    });
  </script>

  {% block extra_scripts %} {% endblock %}
</body>

</html>