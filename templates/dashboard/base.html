<!DOCTYPE html>
<html lang="en">
{% load static %}

<head>
  <title>Dashboard |{% block title %} {% endblock %}</title>

  <!-- Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <meta name="description" content="Portal - Bootstrap 5 Admin Dashboard Template For Developers" />
  <meta name="author" content="Xiaoying Riley at 3rd Wave Media" />
  <link rel="shortcut icon" href="{% static 'dashboard/assets/images/favicon.ico' %}" />

  <!-- FontAwesome JS-->
  <script defer src="{% static 'dashboard/assets/plugins/fontawesome/js/all.min.js' %}"></script>

  <!-- App CSS -->
  <link id="theme-style" rel="stylesheet" href="{% static 'dashboard/assets/css/portal.css' %}" />
  
  <!-- Custom Design Enhancements -->
  <link rel="stylesheet" href="{% static 'dashboard/assets/css/custom-enhancements.css' %}" />
  
  <!-- Modern Redesign CSS -->
  <link rel="stylesheet" href="{% static 'dashboard/assets/css/modern-redesign.css' %}" />
</head>

<body class="app">
  <header class="app-header fixed-top">
    <div class="app-header-inner">
      <div class="container-fluid">
        <div class="app-header-content">
          <div class="row align-items-center">
            <!-- Mobile Menu Toggle -->
            <div class="col-auto">
              <a id="sidepanel-toggler" class="sidepanel-toggler d-inline-block d-xl-none" href="#">
                <i class="fas fa-bars fa-lg"></i>
              </a>
            </div>
            
            <!-- Search Box -->
            <div class="col">
              <div class="app-search-box">
                <form class="app-search-form" role="search">
                  <div class="input-group align-items-center">
                    <span class="input-group-text border-0 bg-transparent">
                      <i class="fas fa-search text-muted"></i>
                    </span>
                    <input id="global-search" type="text" placeholder="Searchâ€¦" name="search" aria-label="Search"
                           class="form-control border-0 shadow-none" autocomplete="off" autocapitalize="off" spellcheck="false" />
                    <button type="button" class="btn clear-search p-0 ms-1" title="Clear" aria-label="Clear search" hidden>
                      <i class="fas fa-times-circle text-muted"></i>
                    </button>
                  </div>
                </form>
              </div>
            </div>

            <!-- Right Side Utilities (Only Profile) -->
            <div class="app-utilities col-auto">
              <div class="app-utility-item app-user-dropdown dropdown">
                <a class="dropdown-toggle d-flex align-items-center gap-2" id="user-dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button"
                  aria-expanded="false">
                  {% if user.profile_picture %}
                  <img class="user-avatar" src="{{ user.profile_picture.url }}" alt="{{ user.username }}" />
                  {% else %}
                  <img class="user-avatar" src="{% static 'dashboard/assets/images/default-profile.png' %}" alt="{{user.username}}" />
                  {% endif %}
                  <span class="user-name d-none d-lg-inline">{{user.username | title}}</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end shadow-lg" aria-labelledby="user-dropdown-toggle">
                  <li class="dropdown-header">
                    <div class="user-info">
                      <strong>{{user.username | title}}</strong>
                      <small class="text-muted d-block">Signed in</small>
                    </div>
                  </li>
                  <li><hr class="dropdown-divider" /></li>
                  <li>
                    <a class="dropdown-item text-danger" href="{% url 'dashboard:logout' %}"><i class="fas fa-sign-out-alt me-2"></i>Log Out</a>
                  </li>
                </ul>
              </div>
              <!--//app-user-dropdown-->
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="app-sidepanel" class="app-sidepanel">
      <div id="sidepanel-drop" class="sidepanel-drop"></div>
      <div class="sidepanel-inner d-flex flex-column">
        <a href="#" id="sidepanel-close" class="sidepanel-close d-xl-none">&times;</a>
        
        <!-- Modern Branding -->
        <div class="app-branding-modern">
          <a class="app-logo-modern" href="{% url 'dashboard:index' %}">
            <div class="logo-icon-modern">
              <i class="fas fa-atom"></i>
            </div>
            <div class="logo-text-container">
              <div class="logo-text-modern">Durbar Physics</div>
              <div class="logo-tagline">Learning Portal</div>
            </div>
          </a>
        </div>

        <!-- Navigation -->
        <nav id="app-nav-main" class="app-nav-modern flex-grow-1">
          <div class="nav-section">
            <div class="nav-section-title">Main Menu</div>
            
            <ul class="app-menu list-unstyled">
              <li class="nav-item">
                <a class="nav-link {% if current_path == '/' %}active{% endif %}" href="{% url 'dashboard:index' %}">
                  <span class="nav-icon">
                    <i class="fas fa-home"></i>
                  </span>
                  <span class="nav-link-text">Dashboard</span>
                </a>
              </li>
              
              <li class="nav-item">
                <a class="nav-link {% if current_path == '/subjects/' %}active{% endif %}"
                  href="{% url 'dashboard:subject_home' %}">
                  <span class="nav-icon">
                    <i class="fas fa-book"></i>
                  </span>
                  <span class="nav-link-text">Subjects</span>
                  <span class="nav-badge">{{ subjects_count|default:"0" }}</span>
                </a>
              </li>
              
              <li class="nav-item">
                <a class="nav-link {% if current_path == '/course/' %}active{% endif %}"
                  href="{% url 'dashboard:course_home' %}">
                  <span class="nav-icon">
                    <i class="fas fa-graduation-cap"></i>
                  </span>
                  <span class="nav-link-text">Courses</span>
                  <span class="nav-badge">{{ courses_count|default:"0" }}</span>
                </a>
              </li>
              
              <li class="nav-item has-submenu">
                <a class="nav-link submenu-toggle {% if 'class' in current_path %}active{% endif %}"
                  href="#" data-bs-toggle="collapse" data-bs-target="#submenu-1"
                  aria-expanded="false" aria-controls="submenu-1">
                  <span class="nav-icon">
                    <i class="fas fa-chalkboard-teacher"></i>
                  </span>
                  <span class="nav-link-text">Classes</span>
                  <span class="submenu-arrow">
                    <i class="fas fa-chevron-down"></i>
                  </span>
                </a>

                <div id="submenu-1" class="collapse submenu-modern" data-bs-parent="#menu-accordion">
                  <ul class="submenu-list list-unstyled">
                    {% for level in levels %}
                    <li class="submenu-item">
                      <a class="submenu-link {% if current_path == '/class/'|add:level.slug %}active{% endif %}" 
                         href="{% url 'dashboard:class_level' level.slug %}">
                        {{ level.name }}
                      </a>
                      <a href="{% url 'dashboard:level_detail' level.pk %}" 
                         class="submenu-action" 
                         title="Edit {{ level.name }}">
                        <i class="fas fa-edit"></i>
                      </a>
                    </li>
                    {% endfor %}
                  </ul>
                </div>
              </li>
              <li class="nav-item">
                <a class="nav-link {% if 'enrollment' in current_path %}active{% endif %}" 
                   href="{% url 'dashboard:enrollment_home' %}">
                  <span class="nav-icon">
                    <i class="fas fa-user-check"></i>
                  </span>
                  <span class="nav-link-text">Enrollments</span>
                </a>
              </li>
            </ul>
          </div>

          <div class="nav-section">
            <div class="nav-section-title">People</div>
            
            <ul class="app-menu list-unstyled">
              <li class="nav-item has-submenu">
                <a class="nav-link submenu-toggle {% if 'teacher' in current_path or 'student' in current_path %}active{% endif %}" 
                   href="#" data-bs-toggle="collapse" data-bs-target="#submenu-2"
                   aria-expanded="false" aria-controls="submenu-2">
                  <span class="nav-icon">
                    <i class="fas fa-users"></i>
                  </span>
                  <span class="nav-link-text">Users</span>
                  <span class="submenu-arrow">
                    <i class="fas fa-chevron-down"></i>
                  </span>
                </a>
                <div id="submenu-2" class="collapse submenu-modern" data-bs-parent="#menu-accordion">
                  <ul class="submenu-list list-unstyled">
                    <li class="submenu-item">
                      <a class="submenu-link {% if 'teacher' in current_path %}active{% endif %}" 
                         href="{% url 'dashboard:teacher_home' %}">
                        <i class="fas fa-chalkboard-teacher me-2"></i> Teachers
                      </a>
                    </li>
                    <li class="submenu-item">
                      <a class="submenu-link {% if 'student' in current_path %}active{% endif %}" 
                         href="{% url 'dashboard:student_home' %}">
                        <i class="fas fa-user-graduate me-2"></i> Students
                      </a>
                    </li>
                  </ul>
                </div>
              </li>

              <li class="nav-item">
                <a class="nav-link {% if 'stream' in current_path %}active{% endif %}" 
                   href="{% url 'dashboard:stream_home' %}">
                  <span class="nav-icon">
                    <i class="fas fa-layer-group"></i>
                  </span>
                  <span class="nav-link-text">Streams</span>
                </a>
              </li>
              
              
            </ul>
          </div>

          <div class="nav-section">
            <div class="nav-section-title">Content</div>
            
            <ul class="app-menu list-unstyled">
              <li class="nav-item">
                <a class="nav-link {% if 'live' in current_path %}active{% endif %}" 
                   href="{% url 'dashboard:live_classes' %}">
                  <span class="nav-icon">
                    <i class="fas fa-video"></i>
                  </span>
                  <span class="nav-link-text">Live Classes</span>
                  <span class="live-indicator"></span>
                </a>
              </li>
              
              <li class="nav-item">
                <a class="nav-link {% if 'video' in current_path %}active{% endif %}" 
                   href="{% url 'dashboard:video_home' %}">
                  <span class="nav-icon">
                    <i class="fas fa-play-circle"></i>
                  </span>
                  <span class="nav-link-text">Videos</span>
                </a>
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </div>
  </header>
  <!--//app-header-->

  {% block content %} {% endblock %}

  <footer class="app-footer">
    <div class="container py-3 d-flex justify-content-center align-items-center" style="min-height:60px;">
      <small class="copyright m-0">Designed by Kitwosd</small>
    </div>
  </footer>
  <!--//app-footer-->
  <!-- Theme toggle script: toggles `dark-mode` class on <body> and persists choice -->
  <script src="{% static 'dashboard/assets/plugins/popper.min.js' %}"></script>
  <script src="{% static 'dashboard/assets/plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'dashboard/assets/js/app.js' %}"></script>
  <script>
    // Lightweight enhancements for the search bar
    document.addEventListener('DOMContentLoaded', function () {
      const input = document.getElementById('global-search');
      const clearBtn = document.querySelector('.app-search-box .clear-search');
      const box = document.querySelector('.app-search-box');

      if (!input || !clearBtn || !box) return;

      const updateState = () => {
        const hasValue = input.value && input.value.trim().length > 0;
        clearBtn.hidden = !hasValue;
        box.classList.toggle('has-value', hasValue);
      };

      input.addEventListener('input', updateState);
      clearBtn.addEventListener('click', () => {
        input.value = '';
        input.focus();
        updateState();
      });

      // Quick focus shortcut: press '/' to focus search when not typing in inputs/textareas
      window.addEventListener('keydown', (e) => {
        if (e.key === '/' && !e.ctrlKey && !e.metaKey && !e.altKey) {
          const tag = (document.activeElement && document.activeElement.tagName) || '';
          if (!['INPUT', 'TEXTAREA', 'SELECT'].includes(tag)) {
            e.preventDefault();
            input.focus();
          }
        }
      });

      updateState();
    });
  </script>

  {% block extra_scripts %} {% endblock %}
</body>

</html>